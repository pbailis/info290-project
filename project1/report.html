<!DOCTYPE html>
<html>
<title>Smart Lock Security: Ho, Lee, Bailis</title>

<xmp theme="spacelab" style="display:none;">
# Smart Lock Security: An Experience Report
#### Grant Ho, Linda Lee, Peter Bailis
#### INFO 290: Sensors, Humans, Data, Apps
----

<!--- http://daringfireball.net/projects/markdown/syntax -->

## Introduction

Over the past year, a number of "smart lock" technologies have entered
the consumer market
([Wired](http://www.wired.com/2013/06/smart-locks/)). These smart
locks augment the functionality offered by traditional door
locks---namely, mediation of access to physical space---with a
spectrum of features, including remote monitoring and control,
electronic (i.e., non-physical) authorization sharing, and hands-free
operation. The core selling point of these devices is
[*usability*](#usability): not only are the advanced features a
novelty to home automation enthusiasts, but these locks genuinely
offer new modalities of interaction with physical spaces.

Unfortunately, the potential benefits of smart lock adoption must be
weighed against new and subtle security vulnerabilities that arise
from their use. Notably, by interfacing the digital (and networked)
with legacy physical access controls, smart locks must account for a
range of [attacks](#attacks) that were previously impossible. For
example, the virtual compromise of a smartphone that is linked to a
smart lock may render a physical space accessible without ever
physically making contact with the smartphone, smart lock, space, or
user; in contrast, an attacker seeking to compromise a traditional
lock would be forced to resort to physical attacks on the lock.

In this project, we sought to understand the trade-offs between
usability and security inherent in these emerging
technologies. Specifically, we evaluated the usability and security of
a Kevo smart lock application, key fob, and lock. We find that Kevo is
susceptible to a range of attacks, including proximity-based attacks,
relay attacks, and directional attacks, raising concerns about
its security in practice. Nevertheless, we are encouraged by the new
user modalities enabled by this technology and plan to investigate
more secure but similarly usable technologies in the second course
project.

The remainder of this document proceeds as follows. We
[begin](#relatedwork) by discussing related work and providing
information on the smart locks we attempted to procure (and the lock
we were able to procure). Next, we discuss [challenges](#challenges)
inherent in our experimental setup. We proceed to describe our
[usability](#usability) experiences with the Kevo lock and outline a
set of [attacks](#attacks)---some of which we performed---as part of
this project. We discuss [feedback](#feedback) from the course
presentation and, subsequently, our plans for [future
work](#futurework) in the domain of smart lock security. Finally, we
[conclude](#conclude) with a set of takeaways for would-be smart lock
customers today.

<a href="#" id="relatedwork"></a>
## Related Work

We begin by briefly surveying related work. While these smart locks
are new entrants on the consumer market, there is a long lineage of
work in the academic community on improving physical authentication
via alternative electronic means. For example, [Balfanz and
Felten](http://dl.acm.org/citation.cfm?id=1251423) suggest the use of
hand-held computers (a PalmPilot) to alleviate the problem of
establishing intent with smartcard-based authentication (i.e., most
smart cards---in our case, physical locks, no less---lack an interface
via which the user can confirm her intent to unlock an electronic
resource). [Al-Muhtadi et
al.](http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=898860&tag=1)
discuss the use of Kerberos authentication to control a number of
smart devices within home automation. The [Grey
system](http://dl.acm.org/citation.cfm?id=2157016) from CMU focuses on
using smartphones to mediate access to office spaces. Much of this
work focuses on *custom* prototype systems for the authentication of
users via non-traditional modalities; our focus here (i.e., for this
project) is on the capabilities and vulnerabilities of commercially
available smart lock technology.

<a href="#" id=""></a>
## Project Setup

We attempted to procure a range of smart locks for security
analysis. We placed orders for a [Kwikset
Kevo](http://www.kwikset.com/kevo/default.aspx), [Goji Smart
Lock](https://www.indiegogo.com/projects/goji-smart-lock), and
[Lockitron](https://lockitron.com/). Unfortunately, the latter two
products failed to ship due to manufacturing delays, and therefore we
proceeded to experiment only on the Kwikset Kevo.

The Kevo is a basic Bluetooth-enabled smart lock available on
[Amazon.com](http://www.amazon.com/Kwikset-Cylinder-Bluetooth-Enabled-Deadbolt/dp/B00CPTD5AQ)
for $219.00. Kwikset actually manufactures a number of traditional
lock systems, but Kevo is its flagship electronic offering.

<div id="wrapper" style="width:100%; text-align:center">
<img src="http://i.i.cbsi.com/cnwk.1d/i/tim2/2013/10/17/2Z9A5520.jpg" align ="center" alt="The Kevo Lock System" height="600" width="600">
</div>
<center>Figure 1: The Kevo smart lock system components. (source: http://www.cnet.com/products/kwikset-kevo-bluetooth-door-lock/2/)</center><br>


For our experiments, we chose to install the Kevo in a two-by-four
piece of wood (rather than a door, which would have proven cumbersome
and likely have provoked the ire of the Soda Hall building
management).

<a href="#" id="challenges"></a>
## Challenges

Briefly, we summarize three challenges we encountered in this work:

 1. Lock availability was surprisingly sparse. Despite placing orders
 well in advance of the project's due date, we have yet to receive
 product from the other manufacturers.

 2. The Kevo lock uses a Bluetooth-based cryptographic communication
 protocol. Without the use of experimental hardware such as
 [Ubertooth](http://ubertooth.sourceforge.net/) or more expensive
 commercially available hardware that would enable us to sniff
 Bluetooth packets, we were unable to actually attempt relay,
 capture-and-replay, or in man-in-the-middle attacks.

 3. Pragmatically, installing the lock was somewhat of a pain. Without
 access to a full working environment in which we could install the
 lock, we ended up drilling holes using a (beefy) loaner power drill
 from the campus machine lock in one of our offices. The East Bay
 Express acted as a useful and recyclable carpet covering.

<a href = "#" id="usability"></a>
## Usability

Traditionally, the interaction model for a non-smart lock is that the user posess a valid key to the lock and for the the user to unlock the door by inserting then rotate the key. In other words, the traditional interaction model for a lock involves a physical authentication token specific to that lock along with a gesture of intent to unlock. As simple as this interaction model is, the interaction model is quite elegant. The only time a lock is unlocked is when a user has a valid physical authentication token and clearly intends to unlock the lock.

The Kevo smart lock offers this traditional interaction model as well, along with two other interaction models. Each of these two methods of unlocking offer unique usability benefits that traditional locks do not provide. For instance, the key fob allows users to unlock and lock doors with more ease. On the other hand, a smart phone app for e-keys allows for easy key distribution, collection, conditional keys (keys which only work on specific times of day, for instance), and logging possibilites.

Although these new interaction models are not without their limitations, these interaction models provide better ease of use to users and unique data previously was unvailable to users. We believe that if security vulnerabilities are adequately mitigated and interaction models improve, the usability benefits provided to users make a compelling argument for smart lock technolgy.

#### User Interaction Model

 * Physical key: To unlock or lock the door, the user has a key which unlocks the door and uses that key to unlock the door. The user can insert the key into the lock and turn the key one way to unlock the lock, and the opposite way to lock the lock.

 * Fob: To unlock or lock the door, the user has a key fob within enough proximity for bluetooth communication between the key fob and the lock, and then touches the lock face. If the lock is currently locked, the lock unlocks and blinks green twice (and optionally, if sound settings are also enabled, beep twice) to give user feedback. If the lock is currently unlocked, the lock locks and blinks red once (and optionally, if sounds settings are also enabled, beep once).  There is also a small LED on the key fob which blinks green or red when locking or unlocking, respectively. 

 <div id="wrapper" style="width:100%; text-align:center">
<img src="http://www.kwikset.com/Images/kevo/keys.png" align ="center" alt="The Kevo Key Fob" height="350" width="350">
</div>
<center>Figure 2: The Kevo bluetooth key fob. (source: http://www.kwikset.com/kevo/default.aspx)</center><br>

 <div id="wrapper" style="width:100%; text-align:center">
<img src="http://launch.it/sites/default/files/kwikset.jpg" align ="center" alt="The Touch Interaction Model" height="500" width="500">
</div>
<center>Figure 3: The fob touch interaction model. (source: http://launch.it/launch/kwikset%C2%AE-kevo%E2%84%A2-smart-lock-turns-your-smartphone-into-a-key)</center><br>


 * Smartphone app: To unlock or lock the door, the user starts the Kevo smart lock appplication on a smartphone. Once authenticated into the application, the user's smart phone can act as the user's fob. The user may touch the lock to unlock or lock the lock. Additionally, the user can then selct a lock to interact with from a list of locks that the user has access to, then press a button to specifically lock or specifically unlock the lock. Once the application performs an action, the phone vibrates to give the user an indication that the appropriate action has been taken.

 <div id="wrapper" style="width:100%; text-align:center">
<img src="http://cdn1.appleinsider.com/13.10.30-Kevo_App-3.jpg" align ="center" alt="The Smartphone Application" height="500" width="500">
</div>
<center>Figure 4: The smart phone application. (source: http://appleinsider.com/articles/13/10/30/review-kwiksets-bluetooth-enabled-kevo-deadbolt-lock)</center><br>

#### Required Setup

The required setup for the lock is quite manageable, although admittedly more complex than a traditional lock. The smart lock can be installed in a door just as a traditional lock would be installed. The additional setup requried is with respect to key fobs and smart phone of the lock's master owner, both of which need to be calibrated in physical proximity of the smart lock. The process is fairly simple and quick, with the calibration process consisting of a two steps: 1) key fob initialization (pressing a button) or smart phone application download and 2) pressing the "calbration" button on the smart lock and holding the key fob or smartphone near the smart lock. We do not believe that this additional setup process is complex enough to deter any users from installing smart locks. Additionally, the setup is fail-safe; if a user fails to calibrate fobs or smart phones, the lock simply operates as a tradtional lock.

#### Information Available to the User

With traditional locks, there is not much information available to the user about a specific lock. With the Kevo smart lock application, users are able to access: a log of who has used an e-key to lock or unlock a specific lock in recent history, the list of people who have an e-key to a specific lock, the number and types (such as conditional keys) of e-keys for that lock, and if the lock has been disabled or not.

<div id="wrapper" style="width:100%; text-align:center">
<img src="http://gadgetreview.com/wp-content/uploads/2013/12/kevo-App-650x576.jpg" align ="center" alt="The Smartphone Application" height="400" width="400">
</div>
<center>Figure 5: The Kevo log of lock and unlock events for e-keys. (source: http://www.gadgetreview.com/2013/12/kwikset-kevo-smartlock-review)</center><br>

However, we found that certain critical data points were not available to the user, such as the status of the lock, logged events for any locking and unlocking with physical keys and key fobs, and what options the lock was configured to at the moment (if sound, light, or safety mode was on). This was dissapointing, especially because there are other lock systems which do provide this information and also reviews of other smart locks with similar criticisms.

#### User Benefits

With the new fob and smartphone interaction model, the user now simply has to touch the lock to unlock or lock a lock, rather than to take the physical key, insert it into the lock, and twisting the key. This makes the lock much more easy to use since the user simply has to posess the key rather than to physically locate the key and to take action. Touch-to-unlock only takes about 3 seconds to lock and unlock the door, whereas using a physical key might take longer, depending on if the user knows where the key is, if the user has hands free, etc.

The Kevo smart lock application provides great management tools for keys as well. Users are now able to grant access, collect keys, and revoke keys by pressing buttons in the application, rather than tracking down the recipient in person and handling the creation, distribution, and collection of physical artifacts. Additionally, the notion of conditional keys--keys which only work during certain times of day, certain days, etc. are a novel idea and great to use for specialized needs, such as a babysitter, maid, or contractor.

#### Areas of Improvement
* Inconsistent Timing: The Kevo smart lock takes a variable amount of time (sometimes up to 20 seconds) to lock or unlock, which can be frustrating fo the user. 

* Unreliable Communication: we found that the bluetooth key fob or smartphone had trouble communicating with the lock when there were objects in the way. It would be reasonable to expect users to store their key fobs or smart phone behind a wallet, inside a purse, or in their back pockets, but the lock has trouble communicating with the key fob during these instances.

<a href = "#" id="attacks"></a>
## Attacks

### Physical Attacks

#### Problem 
A number of physical attacks, such as [lock bumping](http://en.wikipedia.org/wiki/Lock_bumping) 
or outright smashing the lock, already exist against "dumb" locks. 
While smartlocks do not provide additional protection against these existing attacks, they are
susceptible to new physical attacks that exploit the inability of smartlocks to securely gauge a user's intent to unlock/lock. 
Consider "side-of-the-door" attack, where a murderous attacker attempts to break into Alice's home while she's inside. The
pernicious attacker starts by knocking on Alice's front door. Walking close
to the door in order to look into the peephole, Alice inadvertently brings the smartphone/key fob in her pocket
within range of the smartlock's sensors; this allows the dangerous attacker to unlock her door by continuously tapping on the
smart lock keyhole.
#### Solution
Fundamentally, side-of-the-door and other attacks, which we discuss later, exploit weak notions of when a user <i>intends</i>
to unlock or lock a door/vehicle/device. In order to make smart locks as easy to use as possible, manufacturers have
pursued a model that assumes a tap on the smartlock's key hole and the receival of correct authentication messages from a digital key
indicate that an authorized user is trying to unlock/lock the door; side-of-the-door
attacks break these assumptions. We aim to prevent these kinds of attacks by redesigning smartlocks to combine
better user-interaction models with wearable devices/biosensors in order to securely assess the intent of users.
    
### Relay Attacks

#### Problem: 
In a [relay attack](https://eprint.iacr.org/2010/332.pdf), a pair of attackers works to initiate and relay
a live-authentication communication between the lock and key. One attacker stands next to
the key and the other stands next to the lock; broadcasting query signals to the key and lock, the
attackers trigger the legitimate key and lock to begin an authentication process to unlock the door.
Every message sent by the key is then captured as a signal/electromagnetic field by one attacker
and relayed over Wifi or RF to his accomplice, who then demodulates the signal and broadcasts it to the lock;
authentication messages sent by the lock are captured, relayed, and broadcast in the same manner. As a result,
both the digital key and smartlock see completely valid authentication messages from each other and unlock the
door. In essence, this attack maliciously "bridges" the physical gap between a key and lock in order to fool the smartlock
into believing the homeowner is nearby the lock and attempting to open the door.
#### Solution:
Similar to side-of-the-door attacks, more secure user-interaction models and user-intent sensing can mitigate
the threat of relay attacks; for example, attackers might now need to trick the user into performing some gesture
or need to fool a smartwatches' sensor readings in order to ellicit authentication messages from the smartwatch
(digital key).

### Cryptographic Attacks

#### Problem:
A common mantra in applied cryptography is to never invent and implement your own crytographic protocol
from scratch; dozens of existing papers cogently illustrate this point by uncovering a plethora
of vulnerabilities in not only newly proposed crypto schemes, but also ones designed and deployed
at large-scale for many years. Given that Kevo smartlock describes their implementation as a custom,
"military-grade" AES-128 implementation, we are skeptical of the authentication protocol's security.
#### Solution
Vulnerabilities in cryptographic and authentication protocols can be minimized by using ones that have been vetted and deployed for
many years; although well-established crypto protocols like SSL may contain vulnerabilites 
([even after many years of widescale deployment](http://heartbleed.com/)), they are likely to remain more secure and contain
fewer bugs than custom, newly-implemented crypto protocols.
    
### Malware Attacks

#### Problem: 
Malicious apps that gain root permission can intercept and tamper with
traffic on smartphones; more dangerous, this kind of malware can also access data that 
the application stores on the phone (such as private encryption keys used to authenticate to a smartlock). 
Additionally, web malware or vulnerabilities in the smart lock's website/server allow attackers to
grant themselves digital eKeys to unlock any smart lock and/or view a smartlock's audit logs
to see when home owners and residents enter and exit their house.
#### Solution: 
The problems of web malware and server-side vulnerabilities have existed
for many years; aside from hoping websites and servers write secure code,
web vulnerabilities and malware remain an unanswered problem in research. 
While schemes like [CryptDB](http://css.csail.mit.edu/cryptdb/) can be used to protect data like audit logs,
attackers who compromise the servers of smartlock companies will be able to obtain digital eKeys to unlock
any users' smartlocks. 
On the other hand, system designers have greater resources and avenues to combat malware that infects
smartphones and other digital keys. In particular, new advances in hardware and software
architectures have made "trusted/hardware security modules" practical, and many smart devices already 
[ship with](http://www.arm.com/products/processors/technologies/trustzone/index.php) the necessary
hardware to leverage this architecture. These trusted hardware modules can
prevent unauthorized, malicious apps from reading sensitive data, such as the encryption keys used
by the smartlock app. Additionally, we aim to design a wearable device designed for purely authentication purposes;
by physically isolating the apps and protocols used by smart locks from potentially dubious apps on
smart phones and computers, we can strongly mitigate the threat of malware infection on digital-key devices.

### Summary
Among these different attacks, three classes of vulnerabilities underpin the major threat models.
One class of vulnerabilities is implementation error in the authentication protocols
used by smartlocks; established, already implemented
protocols exist for the authentication needs of smartlocks, so there is no reason why
existing smartlocks can't adopt these existing authentication mechanisms and eliminate dangerous
cryptographic threats. While interesting problems might exist in developing a scalable encryption key management 
system for the Internet of Things, these problems lie outside of the realm of wearable devices and biosensors, so we
will not examine them further in this class.
The remaining two categories of vulnerabilities highlight enticing, fundamental problems which beckon for future research
in biosensing and wearable devices. First, the primary reason why malware on digital-key devices constitutes a sailent threat is because of its
ability to read and tamper with data in the smartlock app (e.g. encryption keys used to authenticate to smartlocks).
At the heart of this threat is a problem of weak isolation designs; existing smart phone
apps do a poor job of strongly and explicitly isolating their execution/data from other apps and the phone's operating system.
By combining physical isolation (moving digital keys to a wearable device used only for authentication) and hardware/software architectures
for trusted and isolated modules, we should be able to limit major threats from malware; rigorously analyzing this hypothesis and formalizing
the security guarantees remains an open research question that we are eager to explore.
In terms of the final class of threats, relay and phyiscal attacks (e.g. side-of-the-door attacks) are the result of insecure models to detect user intent. 
By assuming that nearby proximity and weak touch gestures accurately indicate a user's intent to lock or unlock a door, existing smart locks underestimate
the capability of attackers to fool users and smart lock sensors into unintentially granting them access. This question of "securing
communicating intent" will likely benefit from bio-sensor data and better user-interaction models, and it will be the focus
of project 2.
    
<a href="#" id="feedback"></a>
## Class Feedback

We summarize the feedback we received from our in-class presentation
in three primary categories:

 1. **Greater detail about security issues.** Several responses highlighted
 their interest in the security aspects of this work. While security
 is undoubtedly an important aspect of our daily lives, it is easy to
 forget about, and, for one member of this project group, thinking
 about security issues is, in itself, novel. However, a number of
 responses asked for greater detail and thoroughness with respect to
 the attacks we considered as part of this course.

 2. **Additional applications.** Several responses (and in-class
 discussion) suggested potential applications for smart lock
 technology. Applications included the adoption of this technology for
 hotel rooms, AirBnb, and, more generally, simplification of
 authentication for the sharing economy. Other responses expressed
 enthusiasm for the concept of virtual key sharing.

 3. **Potential extensions.** Perhaps the largest category of feedback
 we received dealt with way of improving the security of these
 devices. Suggestions included multi-factor authentication, use of
 near-field communication, and the use of alternative biometric factors.

**Our response:** In all, this feedback was well targeted towards the
  issues we had been thinking about: given our findings, how do we
  improve the security of these devices without compromising
  usability? Unfortunately, seven minutes did not allow a detailed
  discussion of our attack study, but we felt that the demonstration
  we *were* able to perform was useful in conveying both the utility
  and the dangers of this technology. The next section provides
  greater detail as to how we plan to apply this feedback towards the
  second course project.

<a href="#" id="futurework"></a>
## Future Work

**GRANT (linda's comments in file)**

<!-- Grant! USE THIS!!

FROM MY USER BENEFITS SECTION:
With the new fob and smartphone interaction model, the user now simply has to touch the lock to unlock or lock a lock, rather than to take the physical key, insert it into the lock, and twisting the key. This makes the lock much more easy to use since the user simply has to posess the key rather than to physically locate the key and to take action. Touch-to-unlock only takes about 3 seconds to lock and unlock the door, whereas using a physical key might take longer, depending on if the user knows where the key is, if the user has hands free, etc.

The Kevo smart lock application provides great management tools for keys as well. Users are now able to grant access, collect keys, and revoke keys by pressing buttons in the application, rather than tracking down the recipient in person and handling the creation, distribution, and collection of physical artifacts. Additionally, the notion of conditional keys--keys which only work during certain times of day, certain days, etc. are a novel idea and great to use for specialized needs, such as a babysitter, maid, or contractor.

FROM MY USABILITY INTRO:
Although these new interaction models are not without their limitations, these interaction models provide better ease of use to users and unique data previously was unvailable to users. We believe that if security vulnerabilities are adequately mitigated and interaction models improve, the usability benefits provided to users make a compelling argument for smart lock technolgy.

FROM MY AREAS OF IMPROVEMENT SECTION:
* Inconsistent Timing: The Kevo smart lock takes a variable amount of time (sometimes up to 20 seconds) to lock or unlock, which can be frustrating fo the user. 

* Unreliable Communication: we found that the bluetooth key fob or smartphone had trouble communicating with the lock when there were objects in the way. It would be reasonable to expect users to store their key fobs or smart phone behind a wallet, inside a purse, or in their back pockets, but the lock has trouble communicating with the key fob during these instances.

-->

Sketch project II here:

<!-- How about you just talk about what you and David talked about? That watch and smart phone application idea sounds pretty good to me. -->

<a href="#" id="conclusions"></a>
## Conclusions

In this project, we evaluated the security implications of a smart
lock, the Kevo Kwikset, compared to the usability benefits it
offers. While we are excited by the usability benefits---including key
sharing and authentication logging---we are concerned about the
potential vulnerabilities---in particular, those pertaining to
ambiguous intent in physical spaces. In the next project, we plan to
address these issues of intent by incorporating additional biometric
feedback---in the form of watch proximity---to preserve many of these
usability gains while alleviating a large class of security concerns.

## Acknowledgments

The authors would like to thank John Chuang, the students enrolled in
the Fall 2014 offering of INFO 290, Dawn Song, and David Wagner for
their feedback and assistance on this work. This project is supported
in part by the Intel Science and Technology Center for Secure
Computing ([SCRUB](http://scrub.cs.berkeley.edu/)).


</xmp>

<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>
</html>